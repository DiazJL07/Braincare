 
<link rel="stylesheet" href="/css/Articulos.css">
<link rel="stylesheet" href="/css/guide.css">
<div class="InicioArticulos" style="background-color: #35053c !important;">
  <div class="guides-header-text">
    <h1 class="guides-header-title">Artículos</h1>
    <p class="lead">La Psicología es la ciencia que estudia la conducta humana, así como los procesos mentales y, en general, todo lo relativo a la experiencia humana. Explora conceptos como la percepción, la motivación, la personalidad y la inteligencia.</p>
  </div>
</div>

<div class="public-top-search">
  <label class="articles-filter-label"><i class="fas fa-search"></i> Buscar Artículos</label>
  <input type="text" id="articlesPublicSearchInput" class="articles-filter-input" placeholder="Buscar por título o autor..." />
</div>

<div class="contenedorArt1">
  
  <div class="layout-principal">
    
    <div class="columna-articulos">
      <div class="articles-container">
        <% if (articles && articles.length > 0) { %>
          <% articles.forEach(article => { %>
            <div class="article-card">
              <div class="article-content">
                <% if (article.image) { %>
                  <img src="<%= article.image %>" class="article-image" alt="<%= article.title %>">
                <% } else { %>
                  <div class="article-no-image">
                    <i class="bi bi-image" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                    <p>Sin imagen</p>
                  </div>
                <% } %>
                
                <div class="article-info">
                  <div>
                    <div class="infoImport">
                      <span class="article-topic"><%= article.topic %></span>
                      <span class="article-date"><i class="far fa-calendar-alt"></i> <%= new Date(article.publicationDate).toLocaleDateString() %></span>
                    </div>
                    <a href="/articles/<%= article._id %>" class="article-link">
                      <h2 class="article-title"><%= article.title %></h2>
                    </a>
                    <div class="article-meta">
                      <span class="article-author">Por <strong><%= article.author ? article.author.name : 'Autor desconocido' %></strong></span>
                    </div>
                  </div>
                  
                  <div class="article-footer">
                    <span class="article-views"><i class="fas fa-eye"></i> <%= article.views || 0 %> vistas</span>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="no-articles">
            <img src="../img/cooki/CokiLaptop.png" alt="CokiLaptop" class="no-articles-image">
            <h3>No hay artículos disponibles</h3>
            <p>Intenta cambiar los filtros o vuelve más tarde.</p>
          </div>
        <% } %>
      </div>

      <div id="articlesPublicPagination" class="articles-pagination"></div>
    </div>

    <aside class="columna-sidebar">
      
      <div class="sidebar-card">
        <h4 class="sidebar-title"><i class="fas fa-filter"></i> Filtrar Artículos</h4>
        <form action="/articles" method="GET">
          <div class="filter-group">
            <label for="topic" class="filter-label">Tema</label>
            <select class="filter-select" id="topic" name="topic">
              <option value="todos" <%= currentTopic === 'todos' ? 'selected' : '' %>>Todos los temas</option>
              <option value="Transtornos" <%= currentTopic === 'Transtornos' ? 'selected' : '' %>>Transtornos</option>
              <option value="Recomendaciones" <%= currentTopic === 'Recomendaciones' ? 'selected' : '' %>>Recomendaciones</option>
              <option value="Tratamientos" <%= currentTopic === 'Tratamientos' ? 'selected' : '' %>>Tratamientos</option>
              <option value="Prevencion" <%= currentTopic === 'Prevencion' ? 'selected' : '' %>>Prevención</option>
              <option value="Investigacion" <%= currentTopic === 'Investigacion' ? 'selected' : '' %>>Investigación</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="sort" class="filter-label">Ordenar por</label>
            <select class="filter-select" id="sort" name="sort">
              <option value="fecha" <%= currentSort === 'fecha' ? 'selected' : '' %>>Más recientes</option>
              <option value="vistas" <%= currentSort === 'vistas' ? 'selected' : '' %>>Más vistos</option>
            </select>
          </div>

          <button type="submit" class="filter-btn-apply">Actualizar Resultados</button>
        </form>
      </div>

      <div class="sidebar-card">
        <h4 class="sidebar-title"><i class="fas fa-fire" style="color: #F59E0B;"></i> Tendencias (24h)</h4>
        <div class="popular-list">
          <% if (typeof popularArticles24h !== 'undefined' && popularArticles24h && popularArticles24h.length > 0) { %>
            <% popularArticles24h.forEach(p => { %>
              <div class="popular-item">
                <a href="/articles/<%= p._id %>" class="popular-link"><%= p.title %></a>
                <div class="popular-meta">
                  <span><i class="fas fa-eye"></i> <%= p.views24h || 0 %></span>
                  <span><%= p.topic %></span>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <div style="color: #94A3B8; font-size: 0.9rem; text-align: center;">Sin datos recientes</div>
          <% } %>
        </div>
      </div>
      
    </aside>
  </div>
</div>

<script>
  (function(){
    // Script de interactividad (Búsqueda local y Paginación)
    document.querySelectorAll('.popular-list .article-link').forEach(function(a){
      a.addEventListener('click', function(e){ e.preventDefault(); var href = a.getAttribute('href'); if (href) window.location.href = href; });
    });
    const input = document.getElementById('articlesPublicSearchInput');
    const container = document.querySelector('.articles-container');
    const cards = Array.from(container ? container.querySelectorAll('.article-card') : []);
    const pag = document.getElementById('articlesPublicPagination');
    let empty = document.getElementById('articlesEmptyResult');
    let page = 1; const size = 6; // Mostramos 6 por página para mejor diseño
    let query = '';

    function filterItems(){
      const q = query.toLowerCase();
      return cards.filter(card => {
        const title = (card.querySelector('.article-title')?.textContent || '').toLowerCase();
        const author = (card.querySelector('.article-author')?.textContent || '').toLowerCase();
        return (!q || title.includes(q) || author.includes(q));
      });
    }

    function render(){
      const items = filterItems();
      const total = items.length; const pages = Math.max(1, Math.ceil(total/size));
      if(page > pages) page = pages;
      if(page < 1) page = 1;

      // Ocultar todos
      cards.forEach(c => c.style.display='none');
      
      // Mostrar solo los de la página actual
      const start = (page-1)*size; const end = start+size;
      items.slice(start,end).forEach(c=>{ 
        c.style.display='flex'; // Flex para mantener el diseño de tarjeta horizontal
        c.style.animation='fadeInUp 0.3s ease-out'; 
      });

      // Manejo de estado vacío
      if (!empty) {
        empty = document.createElement('div');
        empty.id = 'articlesEmptyResult';
        empty.className = 'guides-empty';
        empty.innerHTML = '<h3>No se encontraron resultados</h3><p>Intenta con otra palabra clave.</p>';
        empty.style.display = 'none';
        container.appendChild(empty);
      }
      empty.style.display = total === 0 ? 'block' : 'none';

      // Renderizar botones de paginación
      if(pag){
        pag.innerHTML='';
        for(let i=1; i<=pages; i++){
          const b = document.createElement('button');
          b.className = 'page-btn'+(i===page?' active':'');
          b.textContent = i;
          b.onclick = function(){ page=i; render(); window.scrollTo({top: 400, behavior: 'smooth'}); };
          pag.appendChild(b);
        }
      }
    }

    if(input){ input.addEventListener('input', function(e){ query = e.target.value || ''; page=1; render(); }); }
    
    // Inicializar
    render();
  })();
</script>

<script src="/js/tradux.js"></script>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<%- include('../partials/footer') %>
