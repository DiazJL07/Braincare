<%- include('../partials/header', { title: title }) %>

<div class="container" style="margin-top: 120px;">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <!-- Portada del perfil -->
      <div class="card mb-4">
        <div class="position-relative">
          <img src="<%= profileUser.getCoverImageUrl() %>" 
               class="card-img-top" 
               style="height: 200px; object-fit: cover;" 
               alt="Foto de portada">
          
          <!-- Foto de perfil superpuesta -->
          <div class="position-absolute" style="bottom: -50px; left: 30px;">
            <% if (profileUser.getProfileImageUrl()) { %>
              <img src="<%= profileUser.getProfileImageUrl() %>" 
                   class="rounded-circle border border-4 border-white" 
                   style="width: 100px; height: 100px; object-fit: cover;" 
                   alt="Foto de perfil">
            <% } else { %>
              <div class="rounded-circle border border-4 border-white bg-secondary d-flex align-items-center justify-content-center" 
                   style="width: 100px; height: 100px; color: white; font-size: 32px; font-weight: bold;">
                <%= profileUser.name.charAt(0).toUpperCase() %>
              </div>
            <% } %>
          </div>
        </div>
        
        <div class="card-body" style="padding-top: 60px;">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h3 class="card-title mb-1"><%= profileUser.name %></h3>
              <p class="text-muted mb-2">
                <i class="fas fa-user-tag"></i>
                <span class="badge <%= profileUser.role === 'admin' ? 'bg-danger' : (profileUser.role === 'psychologist' ? 'bg-success' : 'bg-primary') %> ms-1">
                  <%= profileUser.role === 'admin' ? 'Administrador' : (profileUser.role === 'psychologist' ? 'Psicólogo' : 'Usuario') %>
                </span>
              </p>
              <p class="text-muted mb-0">
                <i class="fas fa-calendar-alt"></i>
                Miembro desde <%= new Date(profileUser.createdAt).toLocaleDateString('es-ES', { 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric' 
                }) %>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Información adicional -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-info-circle"></i>
            Información del Usuario
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <p><strong>Nombre:</strong> <%= profileUser.name %></p>
              <p><strong>Rol:</strong> 
                <span class="badge <%= profileUser.role === 'admin' ? 'bg-danger' : (profileUser.role === 'psychologist' ? 'bg-success' : 'bg-primary') %>">
                  <%= profileUser.role === 'admin' ? 'Administrador' : (profileUser.role === 'psychologist' ? 'Psicólogo' : 'Usuario') %>
                </span>
              </p>
            </div>
            <div class="col-md-6">
              <p><strong>Fecha de registro:</strong> 
                <%= new Date(profileUser.createdAt).toLocaleDateString('es-ES', { 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric' 
                }) %>
              </p>
              <p><strong>Estado:</strong> 
                <% if (profileUser.isBanned) { %>
                  <span class="badge bg-danger">Baneado</span>
                <% } else { %>
                  <span class="badge bg-success">Activo</span>
                <% } %>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Botón para volver -->
      <div class="text-center mt-4">
        <button type="button" class="btn btn-secondary" onclick="handleBack()">
          <i class="fas fa-arrow-left"></i>
          <% if (typeof returnUrl !== 'undefined' && returnUrl) { %>
            <%= returnUrl.includes('/admin/') ? 'Volver al panel de administrador' : 'Volver' %>
          <% } else { %>
            Volver
          <% } %>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
.card {
  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  border: 1px solid rgba(0, 0, 0, 0.125);
}

.card-header {
  background-color: #f8f9fa;
  border-bottom: 1px solid rgba(0, 0, 0, 0.125);
}

.badge {
  font-size: 0.75em;
}

.position-relative {
  position: relative;
}

.position-absolute {
  position: absolute;
}

/* Responsividad */
@media (max-width: 768px) {
  .container {
    margin-top: 100px !important;
    padding: 0 15px;
  }
  
  .col-md-8 {
    padding: 0;
  }
  
  .card-img-top {
    height: 150px !important;
  }
  
  .position-absolute {
    bottom: -40px !important;
    left: 20px !important;
  }
  
  .position-absolute img,
  .position-absolute div {
    width: 80px !important;
    height: 80px !important;
    font-size: 24px !important;
  }
  
  .card-body {
    padding-top: 50px !important;
  }
  
  .card-title {
    font-size: 1.5rem;
  }
  
  .row {
    margin: 0;
  }
  
  .col-md-6 {
    margin-bottom: 1rem;
  }
}

@media (max-width: 576px) {
  .container {
    margin-top: 90px !important;
  }
  
  .card-img-top {
    height: 120px !important;
  }
  
  .position-absolute {
    bottom: -30px !important;
    left: 15px !important;
  }
  
  .position-absolute img,
  .position-absolute div {
    width: 60px !important;
    height: 60px !important;
    font-size: 20px !important;
  }
  
  .card-body {
    padding: 40px 15px 15px 15px !important;
  }
  
  .card-title {
    font-size: 1.25rem;
  }
  
  .text-muted {
    font-size: 0.9rem;
  }
}

/* Mejoras adicionales */
.card {
  margin-bottom: 1.5rem;
}

.btn {
  min-width: 120px;
}

.badge {
  white-space: nowrap;
}
</style>

<script>
  (function(){
    const returnUrl = <%- JSON.stringify(typeof returnUrl !== 'undefined' ? returnUrl : '') %>;
    window.handleBack = function(){
      if (document.referrer && window.history.length > 1) { window.history.back(); return; }
      if (returnUrl) { window.location.href = returnUrl; return; }
      window.location.href = '/';
    };
  })();
</script>

  <!-- Tu JS primero, para que el callback global exista antes de cargar el script de Google -->
  <script src="/js/tradux.js"></script>
  <!-- Script oficial de Google (callback definido en translate.js) -->
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<%- include('../partials/footer') %>